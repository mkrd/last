(()=>{var q=[["m","margin"],["mt","margin-top"],["mb","margin-bottom"],["ml","margin-left"],["mr","margin-right"],["p","padding"],["pt","padding-top"],["pb","padding-bottom"],["pl","padding-left"],["pr","padding-right"],["flex","display.flex"],["flow","display.flex flex-flow"],["justify-content","display.flex justify-content"],["align-items","display.flex align-items"],["align-content","display.flex align-content"],["grow","flex-grow"],["shrink","flex-shrink"],["w","width"],["h","height"],["min-w","min-width"],["min-h","min-height"],["max-w","max-width"],["max-h","max-height"],["pos","position"],["pos.abs","position.absolute"],["pos.rel","position.relative"],["t","top"],["b","bottom"],["l","left"],["r","right"],["z","z-index"],["bg","background"],["bg-color","background-color"],["header","font-size.3rem font-weight.800"],["tiny","transform.scale(0.5)"]];function L(n){let t=n.map(e=>e[0]).filter((e,o,s)=>s.indexOf(e)!==o);if(t.length>0)throw new Error(`Duplicate substitution shortcuts: ${t.join(", ")}`);return Object.fromEntries(n)}var M=L(q),_=M;var m={substitutions:_,config:{mode:"global",log:!1}};function r(...n){!m.config.log||console.log(...n)}var d={};function l(n){if(!!m.config.log)if(n in d){let t=performance.now()-d[n];console.log(`${n} - ${t.toFixed(1)}ms`),delete d[n]}else d[n]=performance.now()}function y(n,t,e={}){n.dispatchEvent(new CustomEvent(t,{detail:e,bubbles:!0,composed:!0,cancelable:!0}))}var A=0;function j(){let n=`${A}`;return A++,n}function b(n,t){return n.filter(e=>t.includes(e))}var h=class{name;ui_tag;modifiers;init;events;constructor(t){this.name=t.name,this.ui_tag=t.ui_tag,this.modifiers={},"modifiers"in t&&(this.modifiers=t.modifiers),this.init=t.init,this.events=t.events}};r("\u{1FA83} Parse components/button");var E={name:"button",ui_tag:"bg-color.var(--ui-primary-color) color.#fff border.none p.10px border-radius.5px font-size.18px font-weight.bold cursor.pointer",modifiers:{secondary:"bg-color.var(--ui-secondary-color)"},init:n=>{r("Button component init",n)},events:{click:n=>{r("Button component clicked",n.target)}}};var f={};function C(n){if(r("\u{1F590}","Register component",n.name),n.name in f)throw new Error(`Cannot register component with name ${n.name} because a component with that name already exists`);if(n.name in _)throw new Error(`Cannot register component with name ${n.name} because a substitution with that name already exists`);f[n.name]=new h(n)}C(E);function N(n){let t=[];for(let e of n){let o=e.getAttribute("ui").split(" "),s=!1;for(let i of o)i.match(/^\d+$/)&&(s=!0);s||t.push(e)}return t}function S(n,t){let e=[...n.querySelectorAll(t)],o=n.querySelectorAll("template");for(let s of o)e=e.concat([...s.content.querySelectorAll(t)]);return e}function T(n,t){return[...new Map(n.map(e=>[t(e),e])).values()]}function w(n){let t=n.split("."),e=t[0],o=t.slice(1).join("."),s=!1;for(var i=0;i<o.length;i++){if("()".includes(o[i])){s=o[i]==="(";continue}!s&&o[i]==="."&&(o=o.substring(0,i)+" "+o.substring(i+1))}return{property:e,value:o}}function g(n){let t=[];for(let e of n.split(" ")){if(e in lastcss.substitutions){for(let s of lastcss.substitutions[e].split(" "))t.push(w(s));continue}let o=e.split(".")[0];if(o in lastcss.substitutions){let s=lastcss.substitutions[o]+e.substring(o.length);for(let i of s.split(" "))t.push(w(i));continue}t.push(w(e))}return T(t,e=>e.property)}var v=class{element;ui_tag_list;component;used_component_modifiers;constructor(t){this.element=t,this.ui_tag_list=t.getAttribute("ui").split(" "),t.removeAttribute("ui")}extract_component_properties=()=>{let t=b(this.ui_tag_list,Object.keys(f));if(t.length>1)throw new Error(`Cannot apply multiple ui components to one element. Choose one from: ${t.join(", ")}`);if(t.length===0){this.component=null;return}this.component=f[t[0]],this.ui_tag_list=this.ui_tag_list.filter(e=>e!==this.component.shortcut),this.used_component_modifiers=b(this.ui_tag_list,Object.keys(this.component.modifiers)),this.ui_tag_list=this.ui_tag_list.filter(e=>!this.used_component_modifiers.includes(e))};apply_component_functions=()=>{if(!this.component)return;if("init"in this.component&&this.component.init(this.element),"events"in this.component)for(let e in this.component.events)this.element.addEventListener(e,this.component.events[e]);let t=`${this.used_component_modifiers.join(" ")} ${this.ui_tag_list.join(" ")}`;this.element.getAttribute("ui")!==t&&this.element.setAttribute("ui",`${this.used_component_modifiers.join(" ")} ${this.ui_tag_list.join(" ")}`)};apply_style_inline=()=>{let t=this.ui_tag_list.join(" ");for(let{property:e,value:o}of g(t))this.element.style[e]=o}},x=class{elements;constructor(t){this.elements=[];for(let e of t){let o=new v(e);o.extract_component_properties(),this.elements.push(o)}}make_global_component_style_sheet=()=>{let t={};for(let o of this.elements){if(!o.component)continue;let s=`[ui~="${o.component.name}"]`;s in t||(t[s]=g(o.component.ui_tag).map(i=>`${i.property}:${i.value};
`).join(""));for(let i of o.used_component_modifiers){let u=`:where([ui~="${o.component.name}"])[ui~="${i}"]`;if(!(u in t)){let p=g(o.component.modifiers[i]).map(a=>`${a.property}:${a.value};
`).join("");t[u]=p}}}var e=document.createElement("style");e.innerHTML=Object.entries(t).map(o=>`${o[0]}{
${o[1]}}`).join(""),document.head.insertBefore(e,document.head.querySelector("style"))};apply_component_functions=()=>{for(let t of this.elements)t.apply_component_functions()};apply_styles_inline=()=>{for(let t of this.elements)t.apply_style_inline()};apply_styles_global=()=>{let t=this.elements,e={};for(let i of t){let u=i.ui_tag_list.join(" "),c="";for(let{property:p,value:a}of g(u))c+=`${p}:${a};`;c in e?e[c].push(i):e[c]=[i]}let o=Object.entries(e).map(([i,u],c)=>{let p=j();return u.map(a=>a.element.setAttribute("ui",[a.element.getAttribute("ui")??"",p].join(" "))),`[ui~="${p}"]{
${i.split(";").join(`;
`)}}`}).join(`
`),s=document.createElement("style");s.innerHTML=o,document.head.appendChild(s)}};function $(n,t=null){t!==null?console.log("\u{1F4CD} Run apply_to_element from source",t,"for element",n):console.log("\u{1F4CD} Run apply_to_element for element",n);let e=new x([n]);e.make_global_component_style_sheet(),e.apply_component_functions(),e.apply_styles_inline(),lastcss.config.mode==="global"?e.apply_styles_global():lastcss.config.mode==="inline"&&e.apply_styles_inline()}function k(){l("\u{1F7E3}\u{1F3C1} Apply all styles");let n=S(document,"[ui]");n=N(n);for(let t of n)$(t,"apply_all");l("\u{1F7E3}\u{1F3C1} Apply all styles")}function O(n,t){l("Mutation observer callback"),console.log("mutation_list",n);for(let e of n)if(e.type==="childList")for(let o of e.addedNodes)o.nodeType===Node.ELEMENT_NODE&&(!o.hasAttribute("ui")||$(o,"childList mutation"));else if(e.type==="attributes"){if(e.target.nodeType!==Node.ELEMENT_NODE||!e.target.hasAttribute("ui")||e.oldValue===null)continue;let o=String(e.oldValue).trim(),s=e.target.getAttribute("ui").trim();if(o===s)continue;$(e.target,"attribute mutation ("+o+" -> "+s+")")}l("Mutation observer callback")}window.lastcss=m;if(!document.body)throw new Error("Unable to initialize Last CSS. Do not use the <script> tag in the header, but rater after the <body> tag");r("\u{1F7E3} Last: start init");l("Last init");y(document,"last:init");k();window.last_css_observer=new MutationObserver(O);window.last_css_observer.observe(document.body,{subtree:!0,attributes:!0,attributeFilter:["ui"],attributeOldValue:!0});y(document,"last:initialized");l("Last init");})();
